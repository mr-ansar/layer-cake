import ansar.create as ar
import ansar.create.storage as sr

a = sr.storage_manifest('./consignment')
e = sr.storage_manifest('./empty')
a3oe = sr.storage_manifest('./add-3-of-each')
ar2oe = sr.storage_manifest('./add-remove-2-of-each')
r3oe = sr.storage_manifest('./remove-3-of-each')

c = [t for t in sr.walk(a)]
#for t in c:
#   print(t[0], t[1].name)


#for t in c:
#   print(t[0], t[1].name, '(%s)' % (t[1].parent.path,))
   
f = ar.File('snapshot', ar.PointerTo(ar.UserDefined(sr.StorageManifest)))
f.store(a)

r, v = f.recover()

c = [t for t in sr.walk(r)]
for t in c:
    print(t[0], t[1].name, '(%s)' % (t[1].parent.path,))



sl = [l for l in sr.storage_delta(r, a)]
el = [l for l in sr.storage_delta(r, e)]
a3oel = [l for l in sr.storage_delta(r, a3oe)]
ar2oel = [l for l in sr.storage_delta(r, ar2oe)]
r3oel = [l for l in sr.storage_delta(r, r3oe)]

sr.show_listings(r)


source = {"a": 1, "b": 2, "c": 3}
target = {"b": 4, "c": 7, "d": 9}

s, t = source.keys(), target.keys()

s - t
t - s

s = os.stat(path)
d = datetime.datetime.fromtimestamp(s.st_mtime, tz=ar.UTC)
m = StorageManifest(path='.', when=d)
